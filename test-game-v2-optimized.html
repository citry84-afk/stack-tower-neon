<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stack Tower Neon - MONETIZATION LIVE</title>
    
    <!-- Google AdSense - REAL MONETIZATION ACTIVE -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4129506161314540" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #050505 0%, #0a0a0a 50%, #1a0a1a 100%);
            color: #00FFFF;
            overflow: hidden;
            height: 100vh;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }
        
        .title {
            font-size: clamp(2rem, 6vw, 3rem);
            font-weight: 900;
            color: #FF0080;
            text-shadow: 0 0 20px #FF0080;
            margin-bottom: 10px;
            letter-spacing: 0.1em;
        }
        
        .subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: 700;
            color: #00FFFF;
            text-shadow: 0 0 15px #00FFFF;
            margin-bottom: 20px;
            letter-spacing: 0.2em;
        }
        
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .screen.active {
            display: flex;
        }
        
        .game-area {
            width: min(400px, 90vw);
            height: 400px;
            border: 2px solid #00FFFF;
            border-radius: 15px;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            overflow: hidden;
            contain: layout style paint;
        }
        
        .block {
            position: absolute;
            border-radius: 5px;
            border: 2px solid #fff;
            transition: none;
        }
        
        .moving-block {
            transition: none;
        }
        
        .perfect {
            animation: perfectGlow 0.5s ease-in-out;
        }
        
        @keyframes perfectGlow {
            0%, 100% { box-shadow: 0 0 10px #39FF14; }
            50% { box-shadow: 0 0 30px #39FF14, 0 0 50px #39FF14; }
        }
        
        .ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: min(400px, 90vw);
            margin: 20px 0;
            padding: 0 10px;
        }
        
        .score {
            font-size: 1.5rem;
            font-weight: 700;
            color: #39FF14;
            text-shadow: 0 0 10px #39FF14;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            background: transparent;
            border: 2px solid #00FFFF;
            color: #00FFFF;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            min-width: 120px;
            max-width: 180px;
        }
        
        .btn:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .btn.primary {
            border-color: #FF0080;
            color: #FF0080;
        }
        
        .btn.primary:hover {
            background: rgba(255, 0, 128, 0.1);
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.5);
        }
        
        .indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 900;
            color: #39FF14;
            text-shadow: 0 0 20px #39FF14;
            z-index: 1000;
            pointer-events: none;
            animation: indicatorPop 1.5s ease-out forwards;
        }
        
        @keyframes indicatorPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }
        
        .instructions {
            text-align: center;
            margin: 20px 0;
            color: #00FFFF;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .loading-text {
            font-size: 1.5rem;
            color: #00FFFF;
            text-shadow: 0 0 15px #00FFFF;
            animation: loadingPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes loadingPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .hidden { display: none !important; }
        
        @keyframes topIndicatorSlide {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            20% {
                opacity: 1;
                transform: translateX(-50%) translateY(0px);
            }
            80% {
                opacity: 1;
                transform: translateX(-50%) translateY(0px);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
        }
        
        @media (max-width: 480px) {
            .controls {
                gap: 10px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.9rem;
                min-width: 100px;
            }
        }

    /* ========================================
    /* ESTILOS PARA POWER-UPS Y LOGROS
    /* ========================================

    .powerup-modal, .achievements-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .powerup-modal.show, .achievements-modal.show {
        opacity: 1;
    }

    .powerup-content, .achievements-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        border-radius: 20px;
        text-align: center;
        color: white;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
    }

    .powerup-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin: 1.5rem 0;
    }

    .powerup-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 1.5rem;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .powerup-item h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1.2rem;
    }

    .powerup-item p {
        margin: 0 0 1rem 0;
        opacity: 0.8;
        font-size: 0.9rem;
    }

    .powerup-actions {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .cost {
        font-weight: bold;
        color: #ffd700;
        font-size: 1.1rem;
    }

    .btn.reward {
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
    }

    .btn.reward:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
    }

    .achievements-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1.5rem 0;
    }

    .achievement-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        border-radius: 10px;
        display: flex;
        align-items: center;
        gap: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .achievement-item.unlocked {
        background: rgba(255, 215, 0, 0.2);
        border-color: #ffd700;
    }

    .achievement-item.locked {
        opacity: 0.5;
    }

    .achievement-icon {
        font-size: 2rem;
    }

    .achievement-info h4 {
        margin: 0 0 0.25rem 0;
        font-size: 1rem;
    }

    .achievement-info p {
        margin: 0;
        font-size: 0.8rem;
        opacity: 0.8;
    }

    .close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
    }
    </style>
    <!-- OPTIMIZACIONES VIRAL + RETENCIÓN + MONETIZACIÓN -->
    <script src="stack-tower-optimizations.js"></script>
</head>
<body>
    <div class="container">
        <!-- Loading Screen -->
        <div id="loading-screen" class="screen active">
            <div class="title">STACK TOWER</div>
            <div class="subtitle">NEON</div>
            <div class="loading-text">⚡ CARGANDO GAME...</div>
        </div>
        
        <!-- Menu Screen -->
        <div id="menu-screen" class="screen">
            <div class="title">STACK TOWER</div>
            <div class="subtitle">NEON</div>
            <div class="instructions">
                🎮 Apila bloques perfectamente<br>
                🎯 Consigue puntos de PERFECTO<br>
                🔥 ¡Haz combos épicos!
            </div>
            <div class="controls">
                <button class="btn primary" onclick="startGame()">🚀 JUGAR</button>
                <button class="btn" onclick="toggleAudio()">🔊 AUDIO</button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="ui">
                <div class="score" id="score">0</div>
                <div style="color: #FF0080;">NIVEL <span id="level">1</span></div>
            </div>
            
            <div class="game-area" id="game-area"></div>
            
            <div class="controls">
                <button class="btn" onclick="stackBlock()">📦 APILAR</button>
                <button class="btn" onclick="pauseGame()" id="pause-btn">⏸️ PAUSA</button>
                <button class="btn" onclick="showMenu()">🏠 MENU</button>
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <div class="title">GAME OVER</div>
            <div style="font-size: 2rem; color: #39FF14; margin: 20px 0;">
                PUNTOS: <span id="final-score">0</span>
            </div>
            <div id="new-record" class="hidden" style="color: #FF0080; font-size: 1.2rem; margin: 10px 0;">
                🏆 ¡NUEVO RÉCORD!
            </div>
            <div class="controls">
                <button class="btn primary" onclick="startGame()">🔄 JUGAR OTRA VEZ</button>
                <button class="btn" onclick="shareScore()">📤 COMPARTIR</button>
                <button class="btn" onclick="showPowerUpMenu()">⚡ POWER-UPS</button>
                <button class="btn" onclick="showAchievements()">🏆 LOGROS</button>
                <button class="btn" onclick="showMenu()">🏠 MENU</button>
            </div>
        </div>
    </div>
    
    <script>
        // Simplified Game State
        let gameState = {
            score: 0,
            level: 1,
            blocks: [],
            currentBlock: null,
            gameActive: false,
            audioEnabled: true,
            streak: 0,
            highScore: parseInt(localStorage.getItem('stackTowerHighScore') || '0')
        };
        
        let gamePaused = false;
        let audioContext = null;
        let backgroundMusicInterval = null;
        
        // Audio System
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('🔊 Audio initialized');
            } catch (e) {
                console.log('Audio not supported');
            }
        }
        
        function playSound(frequency, duration, type = 'sine', volume = 0.1) {
            if (!audioContext || !gameState.audioEnabled) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration/1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration/1000);
            } catch (e) {
                console.log('Sound error:', e);
            }
        }
        
        function playPerfectSound() {
            playSound(880, 200, 'square', 0.15);
            setTimeout(() => playSound(1100, 150, 'square', 0.1), 100);
        }
        
        // Background Music System
        function playBackgroundMusic() {
            if (!audioContext || !gameState.audioEnabled) return;
            
            stopBackgroundMusic(); // Stop any existing music
            
            const melody = [
                // Main melody - catchy and addictive like Mario Bros
                {note: 659, duration: 200}, // E5
                {note: 659, duration: 200}, // E5
                {note: 0, duration: 100},   // Rest
                {note: 659, duration: 200}, // E5
                {note: 0, duration: 100},   // Rest
                {note: 523, duration: 200}, // C5
                {note: 659, duration: 200}, // E5
                {note: 0, duration: 100},   // Rest
                {note: 784, duration: 300}, // G5
                {note: 0, duration: 300},   // Rest
                {note: 392, duration: 300}, // G4
                {note: 0, duration: 300},   // Rest
                
                {note: 523, duration: 200}, // C5
                {note: 0, duration: 200},   // Rest
                {note: 392, duration: 200}, // G4
                {note: 0, duration: 200},   // Rest
                {note: 330, duration: 200}, // E4
                {note: 0, duration: 100},   // Rest
                {note: 440, duration: 200}, // A4
                {note: 0, duration: 100},   // Rest
                {note: 494, duration: 200}, // B4
                {note: 0, duration: 100},   // Rest
                {note: 466, duration: 200}, // Bb4
                {note: 440, duration: 200}, // A4
                
                {note: 392, duration: 266}, // G4
                {note: 659, duration: 266}, // E5
                {note: 784, duration: 266}, // G5
                {note: 880, duration: 200}, // A5
                {note: 0, duration: 100},   // Rest
                {note: 698, duration: 200}, // F5
                {note: 784, duration: 200}, // G5
                {note: 0, duration: 200},   // Rest
                {note: 659, duration: 200}, // E5
                {note: 0, duration: 100},   // Rest
                {note: 523, duration: 200}, // C5
                {note: 587, duration: 200}, // D5
                {note: 494, duration: 200}  // B4
            ];
            
            let noteIndex = 0;
            
            function playNextNote() {
                if (!gameState.audioEnabled || !gameState.gameActive) return;
                
                const note = melody[noteIndex % melody.length];
                
                if (note.note > 0) {
                    playMusicNote(note.note, note.duration, 0.03);
                }
                
                noteIndex++;
                backgroundMusicInterval = setTimeout(playNextNote, note.duration);
            }
            
            playNextNote();
        }
        
        function playMusicNote(frequency, duration, volume) {
            if (!audioContext) return;
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'square'; // Retro chiptune sound
                
                filter.type = 'lowpass';
                filter.frequency.value = frequency * 2;
                filter.Q.value = 1;
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(volume * 0.3, audioContext.currentTime + duration/1000 * 0.9);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration/1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration/1000);
            } catch (e) {
                console.log('Music note error:', e);
            }
        }
        
        function stopBackgroundMusic() {
            if (backgroundMusicInterval) {
                clearTimeout(backgroundMusicInterval);
                backgroundMusicInterval = null;
            }
        }
        
        function playBattleMusic() {
            if (!audioContext || !gameState.audioEnabled) return;
            
            stopBackgroundMusic(); // Stop normal music
            
            const battleMelody = [
                // Faster, more intense melody for high scores
                {note: 784, duration: 150}, // G5
                {note: 880, duration: 150}, // A5
                {note: 988, duration: 150}, // B5
                {note: 1047, duration: 150}, // C6
                {note: 1175, duration: 150}, // D6
                {note: 1319, duration: 150}, // E6
                {note: 1397, duration: 150}, // F6
                {note: 1568, duration: 300}, // G6
                {note: 0, duration: 100},    // Rest
                
                {note: 1568, duration: 100}, // G6
                {note: 1397, duration: 100}, // F6
                {note: 1319, duration: 100}, // E6
                {note: 1175, duration: 100}, // D6
                {note: 1047, duration: 100}, // C6
                {note: 988, duration: 100},  // B5
                {note: 880, duration: 100},  // A5
                {note: 784, duration: 200},  // G5
                {note: 0, duration: 200}     // Rest
            ];
            
            let noteIndex = 0;
            
            function playNextBattleNote() {
                if (!gameState.audioEnabled || !gameState.gameActive) return;
                
                const note = battleMelody[noteIndex % battleMelody.length];
                
                if (note.note > 0) {
                    playMusicNote(note.note, note.duration, 0.04);
                }
                
                noteIndex++;
                backgroundMusicInterval = setTimeout(playNextBattleNote, note.duration);
            }
            
            playNextBattleNote();
        }
        
        function toggleAudio() {
            gameState.audioEnabled = !gameState.audioEnabled;
            const btn = event.target;
            btn.textContent = gameState.audioEnabled ? '🔊 AUDIO' : '🔇 AUDIO';
            
            if (gameState.audioEnabled && audioContext) {
                audioContext.resume();
            }
        }
        
        // Game Logic
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId + '-screen').classList.add('active');
        }
        
        function showMenu() {
            gameState.gameActive = false;
            stopBackgroundMusic(); // Stop music when returning to menu
            showScreen('menu');
        }
        
        function startGame() {
            gameState.score = 0;
            gameState.level = 1;
            gameState.blocks = [];
            gameState.currentBlock = null;
            gameState.gameActive = true;
            gameState.streak = 0;
            gamePaused = false;
            
            showScreen('game');
            
            // Clear game area
            const gameArea = document.getElementById('game-area');
            gameArea.innerHTML = '';
            
            // Create base block at bottom
            createBlock(getGameAreaWidth()/2 - 50, 30, 100, '#39FF14', true);
            
            // Create first moving block
            setTimeout(() => createMovingBlock(), 500);
            
            updateUI();
            
            // Start background music
            if (audioContext) {
                audioContext.resume();
                setTimeout(() => {
                    if (gameState.audioEnabled && gameState.gameActive) {
                        playBackgroundMusic();
                    }
                }, 1000);
            }
        }
        
        function getGameAreaWidth() {
            return document.getElementById('game-area').offsetWidth;
        }
        
        function createBlock(x, y, width, color, isBase = false) {
            const block = document.createElement('div');
            block.className = 'block';
            
            // Ensure block stays within game area bounds
            const safeY = Math.max(0, Math.min(350, y)); // Keep within 0-350 range
            const topPosition = Math.max(20, Math.min(370, 400 - safeY - 30));
            
            block.style.left = x + 'px';
            block.style.top = topPosition + 'px';
            block.style.width = width + 'px';
            block.style.height = '30px';
            block.style.backgroundColor = color;
            
            document.getElementById('game-area').appendChild(block);
            
            const blockData = { element: block, x, y: safeY, width, isBase, moving: false };
            gameState.blocks.push(blockData);
            
            return blockData;
        }
        
        function createMovingBlock() {
            if (!gameState.gameActive || gamePaused) return;
            
            const lastBlock = gameState.blocks[gameState.blocks.length - 1];
            const gameAreaWidth = getGameAreaWidth();
            const blockWidth = Math.max(50, 100 - gameState.level * 2);
            
            // Check if tower is getting too high (near top of game area)
            const nextBlockY = lastBlock.y + 35;
            if (nextBlockY > 320 || gameState.blocks.length > 8) { // 320 leaves room for the new block
                scrollCameraSmooth();
                // After scroll, position new block relative to reorganized tower
                const topBlock = gameState.blocks[gameState.blocks.length - 1];
                var newY = topBlock.y + 35;
            } else {
                // Stack blocks upwards - each new block goes higher
                var newY = nextBlockY;
            }
            
            gameState.currentBlock = createBlock(0, newY, blockWidth, getBlockColor(), false);
            gameState.currentBlock.moving = true;
            gameState.currentBlock.element.classList.add('moving-block');
            
            // Add moving animation data
            gameState.currentBlock.direction = 1;
            gameState.currentBlock.speed = 2 + gameState.level * 0.5;
            
            animateBlock(gameState.currentBlock);
        }
        
        function scrollCameraSmooth() {
            // Keep only the last 1 block (the most recent one) - more challenging!
            const blocksToKeep = 1;
            const blocksToRemove = gameState.blocks.length - blocksToKeep;
            
            if (blocksToRemove <= 0) return;
            
            // Remove old blocks from DOM and array
            for (let i = 0; i < blocksToRemove; i++) {
                const blockToRemove = gameState.blocks[i];
                if (blockToRemove.element && blockToRemove.element.parentNode) {
                    blockToRemove.element.parentNode.removeChild(blockToRemove.element);
                }
            }
            
            // Remove from array
            gameState.blocks = gameState.blocks.slice(-blocksToKeep);
            
            // Reposition the remaining block at the bottom
            gameState.blocks.forEach((block, index) => {
                const newY = 30; // Reset to bottom position
                block.y = newY;
                block.element.style.top = (400 - newY - 30) + 'px';
            });
            
            // Visual and audio feedback - positioned at top to not cover blocks
            showTopIndicator('¡TORRE REORGANIZADA!');
            playSound(880, 200, 'sine', 0.1);
            
            console.log(`📏 Camera scrolled - Blocks remaining: ${gameState.blocks.length}`);
        }
        
        function animateBlock(block) {
            if (!block || !block.moving || !gameState.gameActive || gamePaused) return;
            
            const gameAreaWidth = getGameAreaWidth();
            const newX = block.x + (block.direction * block.speed);
            
            // Bounce off walls
            if (newX <= 0 || newX + block.width >= gameAreaWidth) {
                block.direction *= -1;
                playSound(440, 100, 'square', 0.05);
            }
            
            block.x = Math.max(0, Math.min(gameAreaWidth - block.width, newX));
            block.element.style.left = block.x + 'px';
            
            requestAnimationFrame(() => animateBlock(block));
        }
        
        function stackBlock() {
            if (!gameState.currentBlock || !gameState.currentBlock.moving || !gameState.gameActive || gamePaused) return;
            
            const current = gameState.currentBlock;
            current.moving = false;
            current.element.classList.remove('moving-block');
            
            const previous = gameState.blocks[gameState.blocks.length - 2];
            
            // Calculate overlap
            const leftOverlap = Math.max(0, previous.x - current.x);
            const rightOverlap = Math.max(0, (current.x + current.width) - (previous.x + previous.width));
            const totalOverlap = leftOverlap + rightOverlap;
            
            if (totalOverlap >= current.width) {
                // Game over
                gameOver();
                return;
            }
            
            // Trim block
            const newWidth = current.width - totalOverlap;
            const newX = current.x + leftOverlap;
            
            current.x = newX;
            current.width = newWidth;
            current.element.style.left = newX + 'px';
            current.element.style.width = newWidth + 'px';
            current.element.style.top = (400 - current.y - 30) + 'px'; // Update position after trim
            
            // Check for perfect stack
            const perfectThreshold = 5;
            if (totalOverlap <= perfectThreshold) {
                gameState.streak++;
                const points = 10 + gameState.streak;
                gameState.score += points;
                checkAchievements();                
                // Perfect effects
                current.element.classList.add('perfect');
                playPerfectSound();
                
                showIndicator('PERFECTO! +' + (points - 1));
                
                if (gameState.streak >= 5) {
                    showComboIndicator(`${gameState.streak}x COMBO!`);
                }
            } else {
                gameState.streak = 0;
                gameState.score += 1;
                playSound(523, 150, 'sine', 0.08);
            }
            
            updateUI();
            
            // Level progression
            if (gameState.score > 0 && gameState.score % 20 === 0) {
                gameState.level++;
                showIndicator(`¡NIVEL ${gameState.level}!`);
            }
            
            // Create next block
            setTimeout(() => createMovingBlock(), 1000);
        }
        
        function showIndicator(text) {
            const indicator = document.createElement('div');
            indicator.className = 'indicator';
            indicator.textContent = text;
            document.getElementById('game-area').appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 1500);
        }
        
        function showComboIndicator(text) {
            const indicator = document.createElement('div');
            indicator.className = 'indicator';
            indicator.style.color = '#FF0080';
            indicator.style.textShadow = '0 0 20px #FF0080';
            indicator.textContent = text;
            document.getElementById('game-area').appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 2000);
        }
        
        function showTopIndicator(text) {
            const indicator = document.createElement('div');
            indicator.style.position = 'absolute';
            indicator.style.top = '10px'; // Near the top edge
            indicator.style.left = '50%';
            indicator.style.transform = 'translateX(-50%)';
            indicator.style.fontSize = '1.2rem';
            indicator.style.fontWeight = '900';
            indicator.style.color = '#FFD700';
            indicator.style.textShadow = '0 0 15px #FFD700';
            indicator.style.zIndex = '1000';
            indicator.style.pointerEvents = 'none';
            indicator.style.animation = 'topIndicatorSlide 2s ease-out forwards';
            indicator.textContent = text;
            document.getElementById('game-area').appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 2000);
        }
        
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            
            // Update high score
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('stackTowerHighScore', gameState.highScore.toString());
            }
            
            // Switch to battle music at 50 points
            if (gameState.score === 50 && gameState.audioEnabled && backgroundMusicInterval) {
                playBattleMusic();
                showIndicator('¡MODO BATALLA!');
            }
        }
        
        function gameOver() {
            gameState.gameActive = false;
            stopBackgroundMusic(); // Stop music on game over
            playSound(220, 300, 'sawtooth', 0.15);
            
            setTimeout(() => {
                document.getElementById('final-score').textContent = gameState.score;
                
                if (gameState.score === gameState.highScore && gameState.score > 0) {
                    document.getElementById('new-record').classList.remove('hidden');
                } else {
                    document.getElementById('new-record').classList.add('hidden');
                }
                
                showScreen('gameover');
            }, 1000);
        }
        
        function pauseGame() {
            if (!gameState.gameActive) return;
            
            gamePaused = !gamePaused;
            
            if (gamePaused) {
                document.getElementById('pause-btn').textContent = '▶️ REANUDAR';
                stopBackgroundMusic(); // Pause music
            } else {
                document.getElementById('pause-btn').textContent = '⏸️ PAUSA';
                
                // Resume animation if there's a moving block
                if (gameState.currentBlock && gameState.currentBlock.moving) {
                    animateBlock(gameState.currentBlock);
                }
                
                // Resume music when unpausing
                if (gameState.audioEnabled) {
                    setTimeout(() => {
                        if (gameState.score >= 50) {
                            playBattleMusic();
                        } else {
                            playBackgroundMusic();
                        }
                    }, 500);
                }
            }
        }
        
        function getBlockColor() {
            const colors = ['#FF0080', '#00FFFF', '#39FF14', '#FFD700', '#FF4500', '#8A2BE2'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        function shareScore() {
    captureEpicMoment();
    return;
}

function shareScoreOriginal() {
            const text = `🌈 ¡Conseguí ${gameState.score} puntos en Stack Tower Neon! ¿Puedes superarme?`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Stack Tower Neon',
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback
                const url = encodeURIComponent(window.location.href);
                const shareText = encodeURIComponent(text);
                const shareUrl = `https://twitter.com/intent/tweet?text=${shareText}&url=${url}`;
                window.open(shareUrl, '_blank');
            }
        }
        
        // Event Listeners
        document.getElementById('game-area').addEventListener('click', stackBlock);
        document.getElementById('game-area').addEventListener('touchstart', (e) => {
            e.preventDefault();
            stackBlock();
        });
        
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                stackBlock();
            }
        });
        
        // Initialize
        setTimeout(() => {
            initAudio();
            showMenu();
        }, 1500);
        
        console.log('🎮 Stack Tower Neon - TEST VERSION LOADED!');

    // ========================================
    // FUNCIONES DE POWER-UPS Y LOGROS
    // ========================================

    function showPowerUpMenu() {
        const modal = document.createElement("div");
        modal.className = "powerup-modal";
        modal.innerHTML = `
            <div class="powerup-content">
                <h3>⚡ Power-ups Disponibles</h3>
                <div class="powerup-grid">
                    <div class="powerup-item">
                        <h4>🐌 Cámara Lenta</h4>
                        <p>Ralentiza el tiempo por 5 segundos</p>
                        <div class="powerup-actions">
                            <span class="cost">💰 100</span>
                            <button onclick="buyPowerUp("slowMotion")" class="btn">Comprar</button>
                            <button onclick="showRewardAd("slowMotion", () => activatePowerUp("slowMotion"))" class="btn reward">🎬 Gratis</button>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <h4>🎯 Guía Perfecta</h4>
                        <p>Muestra la posición exacta por 10 segundos</p>
                        <div class="powerup-actions">
                            <span class="cost">💰 200</span>
                            <button onclick="buyPowerUp("perfectGuide")" class="btn">Comprar</button>
                            <button onclick="showRewardAd("perfectGuide", () => activatePowerUp("perfectGuide"))" class="btn reward">🎬 Gratis</button>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <h4>❤️ Vida Extra</h4>
                        <p>Te da una segunda oportunidad</p>
                        <div class="powerup-actions">
                            <span class="cost">💰 500</span>
                            <button onclick="buyPowerUp("extraLife")" class="btn">Comprar</button>
                            <button onclick="showRewardAd("extraLife", () => activatePowerUp("extraLife"))" class="btn reward">🎬 Gratis</button>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <h4>💎 Puntos Dobles</h4>
                        <p>Duplica los puntos por 15 segundos</p>
                        <div class="powerup-actions">
                            <span class="cost">💰 300</span>
                            <button onclick="buyPowerUp("doublePoints")" class="btn">Comprar</button>
                            <button onclick="showRewardAd("doublePoints", () => activatePowerUp("doublePoints"))" class="btn reward">🎬 Gratis</button>
                        </div>
                    </div>
                </div>
                <button onclick="closePowerUpMenu()" class="close-btn">✕</button>
            </div>
        `;
        document.body.appendChild(modal);
        setTimeout(() => modal.classList.add("show"), 100);
    }

    function showAchievements() {
        const modal = document.createElement("div");
        modal.className = "achievements-modal";
        modal.innerHTML = `
            <div class="achievements-content">
                <h3>🏆 Logros</h3>
                <div class="achievements-list">
                    ${Object.entries(achievements).map(([key, achievement]) => `
                        <div class="achievement-item ${achievement.unlocked ? "unlocked" : "locked"}">
                            <div class="achievement-icon">${achievement.unlocked ? "🏆" : "🔒"}</div>
                            <div class="achievement-info">
                                <h4>${achievement.name}</h4>
                                <p>Recompensa: ${achievement.reward} monedas</p>
                            </div>
                        </div>
                    `).join("")}
                </div>
                <button onclick="closeAchievements()" class="close-btn">✕</button>
            </div>
        `;
        document.body.appendChild(modal);
        setTimeout(() => modal.classList.add("show"), 100);
    }

    function buyPowerUp(powerUpType) {
        const powerUp = powerUps[powerUpType];
        if (gameCoins >= powerUp.cost) {
            gameCoins -= powerUp.cost;
            localStorage.setItem("stackTowerCoins", gameCoins.toString());
            updateCoinsDisplay();
            activatePowerUp(powerUpType);
            showNotification(`¡${powerUp.name} comprado!`, "success");
        } else {
            showNotification("No tienes suficientes monedas", "error");
        }
    }

    function activatePowerUp(powerUpType) {
        const powerUp = powerUps[powerUpType];
        showNotification(`${powerUp.name} activado!`, "success");
        
        // Implementar efectos del power-up
        switch(powerUpType) {
            case "slowMotion":
                // Ralentizar el juego
                break;
            case "perfectGuide":
                // Mostrar guía perfecta
                break;
            case "extraLife":
                // Dar vida extra
                break;
            case "doublePoints":
                // Duplicar puntos
                break;
        }
    }

    function closePowerUpMenu() {
        const modal = document.querySelector(".powerup-modal");
        if (modal) {
            modal.classList.remove("show");
            setTimeout(() => modal.remove(), 300);
        }
    }

    function closeAchievements() {
        const modal = document.querySelector(".achievements-modal");
        if (modal) {
            modal.classList.remove("show");
            setTimeout(() => modal.remove(), 300);
        }
    }

    // Inicializar monedas al cargar
    document.addEventListener("DOMContentLoaded", function() {
        updateCoinsDisplay();
    });
    </script>
</body>
</html>
